{"version":3,"file":"hover-effect.es.js","sources":["../src/hover-effect.js"],"sourcesContent":["import * as THREE from 'three';\nimport TweenMax from 'gsap/TweenMax';\n\nexport default function (opts) {\n  var vertex = `\nvarying vec2 vUv;\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n`;\n\n  var fragment = `\nvarying vec2 vUv;\n\nuniform float dispFactor;\nuniform sampler2D disp;\n\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform float angle1;\nuniform float angle2;\nuniform float intensity1;\nuniform float intensity2;\n\nmat2 getRotM(float angle) {\n  float s = sin(angle);\n  float c = cos(angle);\n  return mat2(c, -s, s, c);\n}\n\nvoid main() {\n  vec4 disp = texture2D(disp, vUv);\n  vec2 dispVec = vec2(disp.r, disp.g);\n  vec2 distortedPosition1 = vUv + getRotM(angle1) * dispVec * intensity1 * dispFactor;\n  vec2 distortedPosition2 = vUv + getRotM(angle2) * dispVec * intensity2 * (1.0 - dispFactor);\n  vec4 _texture1 = texture2D(texture1, distortedPosition1);\n  vec4 _texture2 = texture2D(texture2, distortedPosition2);\n  gl_FragColor = mix(_texture1, _texture2, dispFactor);\n}\n`;\n\n  function firstDefined() {\n    for (var i = 0; i < arguments.length; i++) {\n      if (arguments[i] !== undefined) return arguments[i];\n    }\n  }\n\n  var parent = opts.parent;\n  var dispImage = opts.displacementImage;\n  var image1 = opts.image1;\n  var image2 = opts.image2;\n  var intensity1 = firstDefined(opts.intensity1, opts.intensity, 1);\n  var intensity2 = firstDefined(opts.intensity2, opts.intensity, 1);\n  var commonAngle = firstDefined(opts.angle, Math.PI / 4); // 45 degrees by default, so grayscale images work correctly\n  var angle1 = firstDefined(opts.angle1, commonAngle);\n  var angle2 = firstDefined(opts.angle2, -commonAngle * 3);\n  var speedIn = firstDefined(opts.speedIn, opts.speed, 1.6);\n  var speedOut = firstDefined(opts.speedOut, opts.speed, 1.2);\n  var userHover = firstDefined(opts.hover, true);\n  var easing = firstDefined(opts.easing, Expo.easeOut);\n\n  if (!parent) {\n    console.warn('Parent missing');\n    return;\n  }\n\n  if (!(image1 && image2 && dispImage)) {\n    console.warn('One or more images are missing');\n    return;\n  }\n\n  var scene = new THREE.Scene();\n  var camera = new THREE.OrthographicCamera(\n    parent.offsetWidth / -2,\n    parent.offsetWidth / 2,\n    parent.offsetHeight / 2,\n    parent.offsetHeight / -2,\n    1,\n    1000\n  );\n\n  camera.position.z = 1;\n\n  var renderer = new THREE.WebGLRenderer({\n    antialias: false\n  });\n\n  renderer.setPixelRatio(window.devicePixelRatio);\n  renderer.setClearColor(0xffffff, 0.0);\n  renderer.setSize(parent.offsetWidth, parent.offsetHeight);\n  parent.appendChild(renderer.domElement);\n\n  var render = function () {\n    // This will be called by the TextureLoader as well as TweenMax.\n    renderer.render(scene, camera);\n  };\n\n  var loader = new THREE.TextureLoader();\n  loader.crossOrigin = '';\n  var texture1 = loader.load(image1, render);\n  var texture2 = loader.load(image2, render);\n  var disp = loader.load(dispImage, render);\n  disp.wrapS = disp.wrapT = THREE.RepeatWrapping;\n\n  texture1.magFilter = texture2.magFilter = THREE.LinearFilter;\n  texture1.minFilter = texture2.minFilter = THREE.LinearFilter;\n\n  var mat = new THREE.ShaderMaterial({\n    uniforms: {\n      intensity1: {\n        type: 'f',\n        value: intensity1\n      },\n      intensity2: {\n        type: 'f',\n        value: intensity2\n      },\n      dispFactor: {\n        type: 'f',\n        value: 0.0\n      },\n      angle1: {\n        type: 'f',\n        value: angle1\n      },\n      angle2: {\n        type: 'f',\n        value: angle2\n      },\n      texture1: {\n        type: 't',\n        value: texture1\n      },\n      texture2: {\n        type: 't',\n        value: texture2\n      },\n      disp: {\n        type: 't',\n        value: disp\n      },\n    },\n\n    vertexShader: vertex,\n    fragmentShader: fragment,\n    transparent: true,\n    opacity: 1.0,\n  });\n\n  var geometry = new THREE.PlaneBufferGeometry(parent.offsetWidth, parent.offsetHeight, 1);\n  var object = new THREE.Mesh(geometry, mat);\n  scene.add(object);\n\n  function transitionIn() {\n    TweenMax.to(mat.uniforms.dispFactor, speedIn, {\n      value: 1,\n      ease: easing,\n      onUpdate: render,\n      onComplete: render,\n    });\n  }\n\n  function transitionOut() {\n    TweenMax.to(mat.uniforms.dispFactor, speedOut, {\n      value: 0,\n      ease: easing,\n      onUpdate: render,\n      onComplete: render,\n    });\n  }\n\n  if (userHover) {\n    parent.addEventListener('mouseenter', transitionIn);\n    parent.addEventListener('touchstart', transitionIn);\n    parent.addEventListener('mouseleave', transitionOut);\n    parent.addEventListener('touchend', transitionOut);\n  }\n\n  window.addEventListener('resize', function (e) {\n    renderer.setSize(parent.offsetWidth, parent.offsetHeight);\n  });\n\n  this.next = transitionIn;\n  this.previous = transitionOut;\n};\n"],"names":["opts","firstDefined","i","arguments","length","undefined","parent","dispImage","displacementImage","image1","image2","intensity1","intensity","intensity2","commonAngle","angle","Math","PI","angle1","angle2","speedIn","speed","speedOut","userHover","hover","easing","Expo","easeOut","scene","THREE","camera","offsetWidth","offsetHeight","position","z","renderer","antialias","setPixelRatio","window","devicePixelRatio","setClearColor","setSize","appendChild","domElement","render","loader","crossOrigin","texture1","load","texture2","disp","wrapS","wrapT","magFilter","minFilter","mat","uniforms","type","value","dispFactor","vertexShader","fragmentShader","transparent","opacity","geometry","object","add","addEventListener","transitionIn","transitionOut","e","next","previous","console","warn","TweenMax","to","ease","onUpdate","onComplete"],"mappings":"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"}